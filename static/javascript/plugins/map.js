define("plugins/map",function(b,d,a){var c=function(g){var f=this,j,k,h,e,i={mapbox:"containMap",autocomplete:"map-autocomplete",drag:false,startFn:null,endFn:null};this.option=$.extend(i,g);this.MarkerPoint=function(m,s,n,l){var o=this,q=o.option.drag;if(s){j.clearOverlays();var p=new BMap.Icon("http://s.lovewith.me/static/images/map-marker.png",new BMap.Size(50,63),{anchor:new BMap.Size(20,49)});var r=new BMap.Icon("http://s.lovewith.me/static/images/map-marker-shadow.png",new BMap.Size(24,7),{anchor:new BMap.Size(12,7)});e=new BMap.Marker(m,{icon:p,enableDragging:q,raiseOnDrag:true,shadow:r});j.addOverlay(e);e.setAnimation(BMAP_ANIMATION_DROP);if(this.option.drag){this.dragMap()}j.centerAndZoom(m,15)}else{n&&k.getPoint(n,function(t){j.centerAndZoom(t,15);m=[t.lng,t.lat];m=new BMap.Point(parseFloat(m[0],10),parseFloat(m[1],10));e.setPosition(m);l&&l(t)})}};this.dragMap=function(){var l=this;e.addEventListener("dragstart",function(m){l.option.startFn&&l.option.startFn(m)});e.addEventListener("dragend",function(m){l.option.endFn&&l.option.endFn(m,j);l.initAuto(j,k,m)})};this.initAuto=function(p,o,n){var l=this.option;if(n){var m=n.point;p.panTo(m);o.getLocation(m,function(r){var s=r.addressComponents,u=s.province+" "+s.city,q=u+" "+s.district+" "+s.street+" "+s.streetNumber;var t=$("#"+l.autocomplete);(t.size()>0)&&t.val(q)})}};this.init=function(){var q=this.option,m=this;j=new BMap.Map(q.mapbox);if($("#"+q.autocomplete).size()>0){h=new BMap.Autocomplete({input:q.autocomplete,location:j});h.setInputValue(q.address);var p;h.addEventListener("onconfirm",function(s){var r=s.item.value;p=r.province+r.city+r.district+r.street+r.business;n()});function n(){function r(){var t=s.getResults().getPoi(0).point;m.MarkerPoint(t,true)}var s=new BMap.LocalSearch(j,{onSearchComplete:r});s.search(p)}}k=new BMap.Geocoder();if(!q.point){if(q.address){if(q.address.indexOf("|")!=-1){var o=q.address.split("|");k.getPoint(o[1],function(r){if(r){j.centerAndZoom(r,15);m.MarkerPoint(point_new,true)}},o[0])}else{m.parseAddress(q.address,function(r){if(r){j.centerAndZoom(r,15);m.MarkerPoint(r,true)}})}}}else{var l=q.point,l=new BMap.Point(l[0],l[1]);this.MarkerPoint(l,true)}j.enableScrollWheelZoom()};this.parseAddress=function(l,m){k.getPoint(l,function(n){m(n)})};(typeof BMap=="undefined")?(function(){window.initialize=function(){f.init()};function l(){var m=document.createElement("script");m.id="bdmap";m.src="http://api.map.baidu.com/api?v=2.0&ak=KbzPdcGG151GHRpzkN9B6Z6H&callback=initialize";document.body.appendChild(m)}l()})():f.init()};d.render=function(e){return new c(e)}});